# 系统测试计划 - User Story 2 (Web管理控制台)

**测试日期**: 2026-02-09
**测试范围**: Phase 4 (T056-T075) - Web管理控制台完整功能
**测试环境**:
- Backend: localhost:8080
- Frontend: localhost:5173
- Database: MySQL 8.0 (localhost:3306/chatbot_router)
- Cache: Redis 7.x (localhost:6379)

---

## 1. 后端API测试

### 1.1 认证API测试 (AuthController)

| 测试用例 | 端点 | 方法 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 初始化管理员账户 | `/api/auth/init-admin` | POST | 创建admin用户,返回成功 | ⏳ |
| 登录成功 | `/api/auth/login` | POST | 返回JWT token和用户信息 | ⏳ |
| 登录失败(错误密码) | `/api/auth/login` | POST | 返回401错误 | ⏳ |
| 获取用户信息 | `/api/auth/user-info` | GET | 返回当前用户信息 | ⏳ |
| Token刷新 | `/api/auth/refresh` | POST | 返回新的token | ⏳ |
| 修改密码 | `/api/auth/change-password` | POST | 修改成功,旧token失效 | ⏳ |
| 登出 | `/api/auth/logout` | POST | Token加入黑名单 | ⏳ |
| 使用黑名单token访问 | `/api/rules` | GET | 返回401错误 | ⏳ |

### 1.2 规则管理API测试 (RuleController)

| 测试用例 | 端点 | 方法 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 创建规则 | `/api/rules` | POST | 返回创建的规则ID | ⏳ |
| 查询规则列表 | `/api/rules` | GET | 返回分页数据 | ⏳ |
| 按关键词搜索 | `/api/rules?keyword=test` | GET | 返回匹配的规则 | ⏳ |
| 按匹配类型过滤 | `/api/rules?matchType=KEYWORD` | GET | 返回指定类型规则 | ⏳ |
| 获取规则详情 | `/api/rules/{id}` | GET | 返回规则详细信息 | ⏳ |
| 更新规则 | `/api/rules/{id}` | PUT | 更新成功 | ⏳ |
| 复制规则 | `/api/rules/{id}/copy` | POST | 创建副本 | ⏳ |
| 启用/禁用规则 | `/api/rules/{id}/toggle` | PUT | 状态切换成功 | ⏳ |
| 删除规则 | `/api/rules/{id}` | DELETE | 删除成功 | ⏳ |
| 批量删除规则 | `/api/rules/batch` | DELETE | 批量删除成功 | ⏳ |
| 验证正则表达式 | `/api/rules/validate-pattern` | POST | 返回验证结果 | ⏳ |
| 测试规则匹配 | `/api/rules/test` | POST | 返回匹配结果 | ⏳ |

### 1.3 群聊管理API测试 (GroupController)

| 测试用例 | 端点 | 方法 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 查询群聊列表 | `/api/groups` | GET | 返回分页数据 | ⏳ |
| 按关键词搜索群聊 | `/api/groups?keyword=test` | GET | 返回匹配的群聊 | ⏳ |
| 获取群聊详情 | `/api/groups/{id}` | GET | 返回群聊详细信息 | ⏳ |
| 启用/禁用群聊 | `/api/groups/{id}/toggle` | PUT | 状态切换成功 | ⏳ |
| 获取群聊配置 | `/api/groups/{id}/config` | GET | 返回配置信息 | ⏳ |
| 更新群聊配置 | `/api/groups/{id}/config` | PUT | 更新成功 | ⏳ |
| 获取群聊规则 | `/api/groups/{id}/rules` | GET | 返回规则列表 | ⏳ |
| 绑定规则到群聊 | `/api/groups/{id}/rules` | POST | 绑定成功 | ⏳ |
| 解绑群聊规则 | `/api/groups/{id}/rules/{ruleId}` | DELETE | 解绑成功 | ⏳ |
| 批量导入群聊 | `/api/groups/batch-import` | POST | 导入成功 | ⏳ |
| 获取群聊统计 | `/api/groups/{id}/stats` | GET | 返回统计数据 | ⏳ |

### 1.4 日志管理API测试 (LogController)

| 测试用例 | 端点 | 方法 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 查询日志列表 | `/api/logs` | GET | 返回分页数据 | ⏳ |
| 按群聊ID过滤 | `/api/logs?groupId=123` | GET | 返回指定群聊日志 | ⏳ |
| 按用户ID过滤 | `/api/logs?userId=456` | GET | 返回指定用户日志 | ⏳ |
| 按状态过滤 | `/api/logs?sendStatus=FAILED` | GET | 返回失败日志 | ⏳ |
| 按时间范围查询 | `/api/logs?startTime=...&endTime=...` | GET | 返回时间范围内日志 | ⏳ |
| 获取日志详情 | `/api/logs/{id}` | GET | 返回日志详细信息 | ⏳ |
| 导出CSV | `/api/logs/export` | GET | 下载CSV文件 | ⏳ |
| 批量删除日志 | `/api/logs/batch` | DELETE | 批量删除成功 | ⏳ |
| 清理历史日志 | `/api/logs/cleanup` | DELETE | 清理成功 | ⏳ |
| 获取日志统计 | `/api/logs/stats` | GET | 返回统计数据 | ⏳ |
| 获取热门规则 | `/api/logs/top-rules` | GET | 返回规则排名 | ⏳ |
| 获取活跃用户 | `/api/logs/top-users` | GET | 返回用户排名 | ⏳ |
| 获取消息趋势 | `/api/logs/trends` | GET | 返回趋势数据 | ⏳ |
| 重试失败消息 | `/api/logs/{id}/retry` | POST | 重试成功 | ⏳ |

---

## 2. 前端功能测试

### 2.1 认证流程测试

| 测试用例 | 页面 | 操作 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 初始化管理员 | 登录页 | 点击"初始化管理员" | 显示成功提示,自动填充admin/admin123 | ⏳ |
| 登录成功 | 登录页 | 输入正确账号密码 | 跳转到仪表盘 | ⏳ |
| 登录失败 | 登录页 | 输入错误密码 | 显示错误提示 | ⏳ |
| 记住密码 | 登录页 | 勾选"记住密码" | 下次自动填充 | ⏳ |
| 修改密码 | 主布局 | 用户下拉→修改密码 | 修改成功,自动登出 | ⏳ |
| 登出 | 主布局 | 用户下拉→退出登录 | 返回登录页 | ⏳ |
| Token过期 | 任意页面 | 等待token过期 | 自动跳转登录页 | ⏳ |
| 未登录访问 | 直接访问/rules | 浏览器输入URL | 重定向到登录页 | ⏳ |

### 2.2 规则管理页面测试

| 测试用例 | 功能 | 操作 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 加载规则列表 | 列表展示 | 进入页面 | 显示规则列表 | ⏳ |
| 关键词搜索 | 搜索 | 输入关键词搜索 | 显示匹配结果 | ⏳ |
| 匹配类型过滤 | 过滤 | 选择匹配类型 | 显示指定类型规则 | ⏳ |
| 状态过滤 | 过滤 | 选择启用/禁用 | 显示指定状态规则 | ⏳ |
| 重置搜索 | 搜索 | 点击"重置" | 清空条件,显示全部 | ⏳ |
| 新建规则 | 创建 | 填写表单提交 | 创建成功,列表更新 | ⏳ |
| 编辑规则 | 编辑 | 修改规则提交 | 更新成功 | ⏳ |
| 复制规则 | 复制 | 点击复制按钮 | 创建副本 | ⏳ |
| 启用/禁用 | 状态切换 | 点击启用/禁用 | 状态切换成功 | ⏳ |
| 删除规则 | 删除 | 确认删除 | 删除成功 | ⏳ |
| 批量删除 | 批量操作 | 选中多条删除 | 批量删除成功 | ⏳ |
| 正则验证 | 表单验证 | 输入正则表达式 | 实时验证提示 | ⏳ |
| 规则测试 | 测试 | 输入测试消息 | 显示匹配结果 | ⏳ |
| 分页 | 分页 | 切换页码/页大小 | 正确加载数据 | ⏳ |

### 2.3 群聊管理页面测试

| 测试用例 | 功能 | 操作 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 加载群聊列表 | 列表展示 | 进入页面 | 显示群聊列表 | ⏳ |
| 启用/禁用群聊 | 状态切换 | 切换开关 | 状态切换成功 | ⏳ |
| 分页 | 分页 | 切换页码 | 正确加载数据 | ⏳ |

### 2.4 日志管理页面测试

| 测试用例 | 功能 | 操作 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 加载日志列表 | 列表展示 | 进入页面 | 显示日志列表 | ⏳ |
| 群聊选择器 | 过滤 | 选择群聊 | 显示该群聊日志 | ⏳ |
| 用户ID过滤 | 过滤 | 输入用户ID | 显示该用户日志 | ⏳ |
| 状态过滤 | 过滤 | 选择发送状态 | 显示指定状态日志 | ⏳ |
| 时间范围选择 | 过滤 | 选择时间范围 | 显示时间范围内日志 | ⏳ |
| 重置搜索 | 搜索 | 点击"重置" | 清空条件 | ⏳ |
| 导出CSV | 导出 | 点击"导出CSV" | 下载CSV文件 | ⏳ |
| 查看详情 | 详情 | 点击"详情" | 显示详情对话框 | ⏳ |
| 重试失败消息 | 重试 | 点击"重试" | 提交重试请求 | ⏳ |
| 分页 | 分页 | 切换页码/页大小 | 正确加载数据 | ⏳ |

### 2.5 组件测试

| 测试用例 | 组件 | 功能 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 群聊选择器-单选 | GroupSelector | 选择单个群聊 | 正确选中 | ⏳ |
| 群聊选择器-多选 | GroupSelector | 选择多个群聊 | 正确选中 | ⏳ |
| 群聊选择器-搜索 | GroupSelector | 输入关键词 | 远程搜索加载 | ⏳ |
| 群聊选择器-清空 | GroupSelector | 点击清空 | 清空选择 | ⏳ |
| 规则表单-验证 | RuleForm | 提交空表单 | 显示验证错误 | ⏳ |
| 规则表单-正则验证 | RuleForm | 输入正则 | 实时验证 | ⏳ |
| 规则表单-测试 | RuleForm | 测试规则 | 显示匹配结果 | ⏳ |

---

## 3. 集成测试

### 3.1 前后端联调测试

| 测试用例 | 场景 | 操作流程 | 预期结果 | 状态 |
|---------|------|---------|---------|------|
| 完整登录流程 | 认证 | 登录→访问页面→登出 | 全流程正常 | ⏳ |
| 规则CRUD流程 | 规则管理 | 创建→编辑→复制→删除 | 全流程正常 | ⏳ |
| 规则测试流程 | 规则管理 | 创建规则→测试匹配 | 匹配正确 | ⏳ |
| 群聊配置流程 | 群聊管理 | 启用群聊→配置规则 | 配置生效 | ⏳ |
| 日志查询流程 | 日志管理 | 多条件查询→导出CSV | 数据正确 | ⏳ |
| Token刷新流程 | 认证 | 长时间使用→自动刷新 | 无感刷新 | ⏳ |
| 错误处理流程 | 异常处理 | 触发各种错误 | 友好提示 | ⏳ |

### 3.2 缓存测试

| 测试用例 | 场景 | 操作 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 规则缓存 | Pinia Store | 5分钟内重复访问 | 使用缓存,不请求API | ⏳ |
| 群聊缓存 | Pinia Store | 5分钟内重复访问 | 使用缓存,不请求API | ⏳ |
| 缓存失效 | Pinia Store | 创建/更新/删除 | 缓存自动失效 | ⏳ |
| Token黑名单 | Redis | 登出后使用token | 返回401 | ⏳ |

---

## 4. 性能测试

### 4.1 响应时间测试

| 测试用例 | 端点 | 预期响应时间 | 实际响应时间 | 状态 |
|---------|------|-------------|-------------|------|
| 登录API | POST /api/auth/login | < 500ms | - | ⏳ |
| 规则列表API | GET /api/rules | < 300ms | - | ⏳ |
| 群聊列表API | GET /api/groups | < 300ms | - | ⏳ |
| 日志列表API | GET /api/logs | < 500ms | - | ⏳ |
| 日志导出API | GET /api/logs/export | < 2s | - | ⏳ |

### 4.2 并发测试

| 测试用例 | 场景 | 并发数 | 预期结果 | 状态 |
|---------|------|--------|---------|------|
| 登录并发 | 多用户同时登录 | 50 | 全部成功 | ⏳ |
| 规则查询并发 | 多用户查询规则 | 100 | 全部成功 | ⏳ |
| 日志写入并发 | 多条日志同时写入 | 200 | 全部成功 | ⏳ |

---

## 5. 安全测试

### 5.1 认证授权测试

| 测试用例 | 场景 | 操作 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| 无token访问 | 未登录访问API | 不带token请求 | 返回401 | ⏳ |
| 错误token访问 | 伪造token | 使用伪造token | 返回401 | ⏳ |
| 过期token访问 | token过期 | 使用过期token | 返回401 | ⏳ |
| 黑名单token访问 | 登出后访问 | 使用已登出token | 返回401 | ⏳ |

### 5.2 输入验证测试

| 测试用例 | 场景 | 输入 | 预期结果 | 状态 |
|---------|------|------|---------|------|
| SQL注入 | 规则搜索 | ' OR '1'='1 | 安全过滤 | ⏳ |
| XSS攻击 | 规则内容 | <script>alert(1)</script> | 安全转义 | ⏳ |
| 正则DoS | 规则模式 | (a+)+ | 拒绝或超时保护 | ⏳ |

---

## 6. 测试执行记录

### 测试环境准备

```bash
# 1. 启动MySQL
docker start mysql-chatbot || docker run -d --name mysql-chatbot \
  -e MYSQL_ROOT_PASSWORD=root \
  -e MYSQL_DATABASE=chatbot_router \
  -p 3306:3306 mysql:8.0

# 2. 启动Redis
docker start redis-chatbot || docker run -d --name redis-chatbot \
  -p 6379:6379 redis:7-alpine

# 3. 启动后端
cd /Users/zexinxu/IdeaProjects/specqq
mvn spring-boot:run

# 4. 启动前端
cd frontend
npm run dev
```

### 测试执行时间
- 开始时间: 待执行
- 结束时间: 待执行
- 总耗时: 待执行

### 测试结果统计
- 总测试用例数: 待统计
- 通过数: 0
- 失败数: 0
- 阻塞数: 0
- 通过率: 0%

---

## 7. 问题记录

| 问题ID | 严重程度 | 问题描述 | 影响范围 | 状态 | 解决方案 |
|--------|---------|---------|---------|------|---------|
| - | - | - | - | - | - |

---

## 8. 测试结论

**待测试完成后填写**

### 功能完整性
- [ ] 所有API端点正常工作
- [ ] 所有前端页面正常显示
- [ ] 所有用户操作流程完整

### 性能指标
- [ ] 响应时间满足要求
- [ ] 并发处理能力达标
- [ ] 资源占用合理

### 安全性
- [ ] 认证授权机制有效
- [ ] 输入验证完善
- [ ] 敏感信息保护

### 可用性
- [ ] 用户界面友好
- [ ] 错误提示清晰
- [ ] 操作流程顺畅

### 建议
- 待测试完成后填写

---

**测试负责人**: Claude Code
**审核人**: 待定
**批准人**: 待定
